<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>–í—ã–±–æ—Ä —Ç–µ—Å—Ç–æ–≤</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header>
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h1>
        <h2>–°–∞–π—Ç –ø–æ—Å–≤—è—â–µ–Ω –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—é —Ç–µ—Å—Ç–æ–≤. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–π—Ç–∏.</h2>
    </header>
    <main>
        <div id="test-list"></div>
        <button id="add-test-button">+</button>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ -->
    <div id="myModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞</h2>
            <input type="text" id="testTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞" />
            <div id="questionsContainer"></div>
            <div id="navigation">
                <button class="button" onclick="addQuestion()">+</button>
                <button class="button" id="removeQuestionButton" onclick="removeQuestion()">-</button>
            </div>
            <button id="saveTestButton" class="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã -->
    <div id="choice-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>–•–æ—Ç–∏—Ç–µ –ª–∏ –≤—ã —Å—Ä–∞–∑—É –≤–∏–¥–µ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞?</h2>
            <button id="yes-answer-button">–î–∞</button>
            <button id="no-answer-button">–ù–µ—Ç</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function initModalChoices() {
            const choiceModal = document.getElementById("choice-modal");
            const yesButton = document.getElementById("yes-answer-button");
            const noButton = document.getElementById("no-answer-button");

            // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            choiceModal.style.display = "flex";

            yesButton.onclick = () => {
                console.log("–ö–Ω–æ–ø–∫–∞ '–î–∞' –Ω–∞–∂–∞—Ç–∞");
                choiceModal.style.display = "none"; // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–µ—Å—Ç–∞
                window.location.href = 'test.html'; // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç currentTest
            };

            noButton.onclick = () => {
                console.log("–ö–Ω–æ–ø–∫–∞ '–ù–µ—Ç' –Ω–∞–∂–∞—Ç–∞");
                choiceModal.style.display = "none"; // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–µ—Å—Ç–∞
                window.location.href = 'test.html'; // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç currentTest
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Å—Ç–æ–≤
        async function loadTests() {
            try {
                const response = await fetch('data.json'); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª data.json
                const tests = await response.json(); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—Ç–≤–µ—Ç –≤ JSON

                const savedTests = JSON.parse(localStorage.getItem('tests')) || []; // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
                const allTests = [...tests, ...savedTests]; // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ç–µ—Å—Ç—ã

                const testList = document.getElementById('test-list'); // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤
                testList.innerHTML = ''; // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                allTests.forEach((test, index) => {
                    const testItem = document.createElement('div'); // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç div –¥–ª—è —Ç–µ—Å—Ç–∞
                    testItem.classList.add('test-item-container'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

                    const testTitle = document.createElement('h3'); // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç h3 –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ç–µ—Å—Ç–∞
                    testTitle.textContent = test.title; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç —ç–ª–µ–º–µ–Ω—Ç–∞
                    testTitle.classList.add('test-item'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞

                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                    testTitle.onclick = () => {
                        localStorage.setItem('currentTest', JSON.stringify(test)); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Ç–µ—Å—Ç –≤ localStorage
                        initModalChoices(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—ã–±–æ—Ä
                    };

                    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'üóëÔ∏è'; 
                    deleteButton.classList.add('delete-button');
                    deleteButton.disabled = index < 3; // –ù–µ–∞–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–≤—ã—Ö —Ç—Ä–µ—Ö —Ç–µ—Å—Ç–æ–≤
                    deleteButton.onclick = () => {
                        const updatedTests = JSON.parse(localStorage.getItem('tests')) || [];
                        updatedTests.splice(index - tests.length, 1); // –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç
                        localStorage.setItem('tests', JSON.stringify(updatedTests)); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
                        loadTests(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
                    };

                    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    testItem.appendChild(testTitle);
                    testItem.appendChild(deleteButton);
                    testList.appendChild(testItem);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–µ—Å—Ç–æ–≤:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞
        function openModal() {
            document.getElementById('myModal').style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal() {
            document.getElementById('myModal').style.display = 'none';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ø–ª—é—Å"
        document.getElementById('add-test-button').onclick = openModal;

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫ –∏–ª–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.getElementById("closeModal").onclick = closeModal;
        window.onclick = function(event) {
            const modal = document.getElementById("myModal");
            if (event.target === modal) {
                closeModal();
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
        function saveTest() {
            const testTitle = document.getElementById('testTitle').value;
            const questionsContainer = document.getElementById('questionsContainer');
            const questions = [];

            for (let question of questionsContainer.children) {
                const questionText = question.querySelector('input[type="text"]').value;
                const options = Array.from(question.querySelectorAll('.answer-option')).map((option, index) => {
                    const optionText = option.querySelector('input[type="text"]').value;
                    return {
                        id: `id${index + 1}`,
                        text: optionText
                    };
                });
                const correctOptionId = options.length > 0 ? options[0].id : null;

                questions.push({
                    id: `id${questions.length + 1}`,
                    question: questionText,
                    correct: correctOptionId,
                    options: options
                });
            }

            const test = {
                id: `id${Date.now()}`,
                title: testTitle,
                questions: questions
            };

            const savedTests = JSON.parse(localStorage.getItem('tests')) || [];
            savedTests.push(test);
            localStorage.setItem('tests', JSON.stringify(savedTests));

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
            loadTests();
            closeModal(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç"
        document.getElementById('saveTestButton').onclick = saveTest;

        // –í—ã–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = loadTests;
    </script>
</body>
</html>
